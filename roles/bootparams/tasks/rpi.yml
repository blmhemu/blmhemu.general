---

- name: Setting params in /boot/firmware/cmdline.txt
  block:
    - become: true
      lineinfile:
        path: /proc/cmdline
        regexp: "(^|.* ){{item}}($| .*)"
        state: absent
      check_mode: true
      register: param_check
      changed_when: false

    - lineinfile:
        backrefs: true
        path: /boot/firmware/cmdline.txt
        regexp: "^(.*)$"
        line: '\1 {{item}}"'
      when: param_check.found == 0
      notify: update grub
  with_items: boot_params
